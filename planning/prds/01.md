# Product Requirements Document (PRD)

## Waterman - Additional Features

**Version:** 1.0  
**Date:** 2025-12-28  
**Status:** Draft

---

## Overview

This PRD outlines additional features to enhance the Waterman application, expanding support for multiple water sports, improving user experience, and enabling deployment to production.

---

## 1. Sport Selection Feature

### 1.1 Description

Users should be able to select one or more water sports at the top of the page. The application will initially support two sports:

- **Wingfoiling** (default)
- **Surfing**

Users can select multiple sports simultaneously to see forecasts for all selected sports.

### 1.2 Requirements

- Add a multi-select sport selector component at the top of the page (below or within the Header)
- Default selection should include "Wingfoiling"
- Users can select/deselect multiple sports (checkboxes or toggle buttons)
- Sport selections should persist across page navigation (localStorage or URL parameter)
- When sports are selected, the UI should display spots and conditions for all selected sports
- Visual indicator should clearly show all currently selected sports
- Forecasts should be clearly labeled by sport type

### 1.3 Technical Considerations

- Store selected sports as an array in client-side state (React state or localStorage)
- Update filtering logic to respect multiple sport selections
- Modify spot queries to filter by sport types (supporting multiple)
- UI should handle displaying mixed sport forecasts clearly

---

## 2. Sport-Specific Spots

### 2.1 Description

Spots can support one or more sports. Currently, all spots in the database are wingfoil spots. A spot can be suitable for multiple sports (e.g., a spot might work for both wingfoiling and surfing).

### 2.2 Requirements

- Add `sports` field to spots table/schema as an array to support multiple sports per spot
- Migrate existing spots to be marked with `["wingfoil"]` sport
- Add example surf spot: **Carcavelos** (https://windy.app/forecast2/spot/8512111/Carcavelos) with `["surfing"]` sport
- Spots can have multiple sports in their array (e.g., `["wingfoil", "surfing"]`)
- Filter spots displayed based on selected sports (show spots that have at least one matching selected sport)
- Ensure spot configuration (spotConfigs) supports multiple configs per spot (one per sport)

### 2.3 Technical Considerations

- Update database schema to include `sports: v.array(v.string())` field in spots table
- Migration script to update existing spots to use array format
- Update spot queries to filter by sports array (check if any sport in array matches selected sports)
- Update scraper to handle different data requirements for different sports
- Support multiple spotConfigs per spot (one config per sport type)

---

## 3. Responsive Design

### 3.1 Description

The application currently looks poor on mobile devices. A responsive design must be implemented to ensure a good user experience across all device sizes.

### 3.2 Requirements

- Mobile-first responsive design approach
- Breakpoints: Mobile (< 768px), Tablet (768px - 1024px), Desktop (> 1024px)
- Components should adapt layout for smaller screens:
  - Header should be mobile-friendly
  - DaySection should stack vertically on mobile
  - **ForecastSlot should display as a card layout on mobile** (instead of row layout)
  - Each time slot should be a distinct card with all relevant information
  - Cards should be full-width on mobile, with appropriate spacing
  - Text sizes should be readable on mobile
  - Touch targets should be appropriately sized (min 44x44px)
- Navigation and interactions should work smoothly on touch devices

### 3.3 Technical Considerations

- Review and update Tailwind CSS classes for responsive breakpoints
- Test on actual mobile devices or browser dev tools
- Ensure images and icons scale appropriately
- Consider collapsible sections for mobile to reduce scrolling

---

## 4. Deployment via Hover.com

### 4.1 Description

Deploy the application to production using Hover.com hosting platform.

### 4.2 Requirements

- Set up Hover.com account and project
- Configure deployment pipeline
- Environment variables setup:
  - `NEXT_PUBLIC_CONVEX_URL`
  - Any other required environment variables
- Domain configuration (if applicable)
- SSL certificate setup
- Ensure Convex backend is accessible from production
- Set up automated deployments (optional but recommended)

### 4.3 Technical Considerations

- Review Hover.com documentation for Next.js deployment
- Ensure build process works correctly
- Set up proper environment variable management
- Consider CI/CD integration if available
- Test deployment in staging environment first

---

## 5. Group Reports by Spot per Day

### 5.1 Description

For each day, group the forecast report by spot, making it easier to see the best times for each spot.

### 5.2 Current Behavior

Currently, slots are grouped by day and displayed chronologically across all spots.

### 5.3 Requirements

- Within each day section, group slots by spot
- Display spot name as a sub-header within each day
- Sort spots alphabetically or by some priority within each day
- Maintain chronological ordering of time slots within each spot group
- Visual separation between spot groups (border, spacing, or background)

### 5.4 Technical Considerations

- Update `DaySection` component to group slots by spot
- Modify data processing in `page.js` to maintain spot grouping
- Consider adding spot-level summary metrics (e.g., "Best time: 2pm")

---

## 6. Tide Data for Surfing

### 6.1 Description

For surfing, high tide and low tide information is critical. The scraper needs to be enhanced to capture tide data from Windy.app.

### 6.2 Requirements

- Extend scraper to extract tide data (high tide and low tide times and heights)
- Add tide fields to database schema:
  - `tideHeight` (optional number)
  - `tideType` (optional string: "high" | "low")
  - `tideTime` (optional timestamp)
- Store tide data in forecast_slots table
- **Display tide information in a separate section in the UI when surfing is selected as a sport**
- Tide section should show high and low tide times and heights for the forecast period
- Tide data should be clearly separated from other forecast data for better readability

### 6.3 Technical Considerations

- Research Windy.app tide data structure and selectors
- Update `lib/scraper.js` to extract tide information
- May need to click additional toggles or navigate to tide view
- Update database schema in `convex/schema.ts`
- Update `saveForecastSlots` mutation to accept tide data
- Update UI components to display tide information

### 6.4 Example Surf Spot

- **Carcavelos**: https://windy.app/forecast2/spot/8512111/Carcavelos
- Use this as reference for testing tide scraping

---

## 7. Robust Condition Criteria in Database

### 7.1 Description

Set up comprehensive condition criteria in the database that are appropriate for each sport type. Each spot will have master criteria (default conditions), but users should be able to override these with their own personal criteria preferences.

### 7.2 Wingfoiling Criteria

Primary factors:

- **Wind Direction** (degrees 0-360): Direction range that works for the spot
- **Wind Speed** (knots): Minimum wind speed required
- **Wind Gusts** (knots): Minimum gust speed required

### 7.3 Surfing Criteria

Primary factors:

- **Swell Size** (feet/meters): Minimum and/or optimal swell height
- **Swell Direction** (degrees 0-360): Direction range that works for the spot
- **Swell Period** (seconds): Minimum period for quality waves
- **Tide** (high/low): Optimal tide conditions (may be high tide, low tide, or both)

### 7.4 Requirements

#### Master Criteria (Spot-Level)

- Extend `spotConfigs` table schema to support sport-specific criteria:
  - For Wingfoiling: `minSpeed`, `minGust`, `directionFrom`, `directionTo` (already exists)
  - For Surfing: `minSwellHeight`, `maxSwellHeight`, `swellDirectionFrom`, `swellDirectionTo`, `minPeriod`, `optimalTide` (new fields)
- Make criteria fields optional and sport-specific
- These are the default/master criteria for each spot-sport combination
- Allow multiple configs per spot (one per sport) if a spot supports multiple sports

#### User Override Criteria

- Create a new table `userSpotConfigs` to store user-specific criteria overrides
- Schema should include:
  - `userId` (or session identifier for anonymous users)
  - `spotId`: Reference to the spot
  - `sport`: Sport type
  - Same criteria fields as `spotConfigs` (all optional)
- Users can customize criteria per spot-sport combination
- If user has an override, use that instead of master criteria
- If no user override exists, fall back to master criteria
- UI should allow users to:
  - View current criteria (master or override)
  - Edit/create their own criteria
  - Reset to master criteria
  - Save preferences (localStorage for anonymous, or user account if implemented)

### 7.5 Technical Considerations

- Update `convex/schema.ts`:
  - Add optional surfing-specific fields to `spotConfigs`
  - Create new `userSpotConfigs` table with similar structure
- Update filtering logic in `page.js`:
  - Check for user override first, then fall back to master criteria
  - Apply appropriate criteria based on sport type
- Consider creating separate config tables or using a more flexible schema
- Update `addSpot` mutation to accept sport-specific configs
- Create mutations/queries for user config management:
  - `saveUserSpotConfig`: Save user override
  - `getUserSpotConfig`: Retrieve user override (or master if none)
  - `deleteUserSpotConfig`: Remove override to revert to master
- Migration script to update existing configs
- For anonymous users, store preferences in localStorage and sync to Convex if desired

---

## Implementation Priority

1. **High Priority:**
   - Sport Selection Feature (#1)
   - Sport-Specific Spots (#2)
   - Robust Condition Criteria (#7)

2. **Medium Priority:**
   - Group Reports by Spot (#5)
   - Tide Data for Surfing (#6)

3. **Lower Priority:**
   - Responsive Design (#3)
   - Deployment via Hover.com (#4)

---

## Database Schema Changes Summary

### spots table

- Add `sports: v.array(v.string())` field to support multiple sports per spot

### spotConfigs table (Master Criteria)

- Keep existing wingfoiling fields: `minSpeed`, `minGust`, `directionFrom`, `directionTo`
- Add optional surfing fields:
  - `minSwellHeight: v.optional(v.number())`
  - `maxSwellHeight: v.optional(v.number())`
  - `swellDirectionFrom: v.optional(v.number())`
  - `swellDirectionTo: v.optional(v.number())`
  - `minPeriod: v.optional(v.number())`
  - `optimalTide: v.optional(v.string())` // "high" | "low" | "both"

### userSpotConfigs table (User Override Criteria) - NEW

- `userId: v.string()` (or session identifier)
- `spotId: v.id("spots")`
- `sport: v.string()`
- All criteria fields (same as spotConfigs, all optional):
  - Wingfoiling: `minSpeed`, `minGust`, `directionFrom`, `directionTo`
  - Surfing: `minSwellHeight`, `maxSwellHeight`, `swellDirectionFrom`, `swellDirectionTo`, `minPeriod`, `optimalTide`
- Index on `["userId", "spotId", "sport"]` for efficient lookups

### forecast_slots table

- Add tide fields:
  - `tideHeight: v.optional(v.number())`
  - `tideType: v.optional(v.string())` // "high" | "low"
  - `tideTime: v.optional(v.number())` // timestamp

---

## Testing Requirements

- Test sport selection and filtering
- Test spot filtering by sport
- Test responsive design on multiple devices/browsers
- Test tide data scraping for surf spots
- Test condition criteria filtering for both sports
- Test spot grouping within day sections
- Test deployment process on Hover.com

---

## Decisions Made

1. **Spots can support multiple sports** - A spot can have an array of sports it supports (e.g., `["wingfoil", "surfing"]`)
2. **Users can see multiple sports simultaneously** - Multi-select sport selector allows users to view forecasts for multiple sports at once
3. **Mobile layout: Card-based** - Each time slot displays as a card on mobile instead of a row layout
4. **Tide data: Separate section** - When surfing is selected, tide information displays in a dedicated section separate from other forecast data
5. **Criteria: Master + User Overrides** - Each spot has master criteria (default), but users can create their own override criteria per spot-sport combination

---

## Notes

- Current spots are all wingfoil spots and need to be migrated to use `sports: ["wingfoil"]` array format
- Carcavelos is provided as an example surf spot for testing (should be added with `sports: ["surfing"]`)
- The scraper currently handles wind and swell data; tide data extraction needs to be added
- Mobile responsiveness is a critical UX improvement (card-based layout for mobile)
- User criteria overrides can be stored in localStorage for anonymous users, or in Convex `userSpotConfigs` table if user accounts are implemented
- Multiple sports per spot allows for spots that work well for both wingfoiling and surfing
